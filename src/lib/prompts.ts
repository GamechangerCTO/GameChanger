// מבנה נתוני החברה
interface Company {
  id: string;
  name: string;
  industry?: string;
  description?: string;
  target_audience?: string;
  services?: string[];
  sales_process?: string;
  pain_points?: string[];
  unique_selling_points?: string[];
  segment?: string;
  product_details?: string;
  product_cost?: string;
  product_types?: string;
  target_audience_type?: 'C2B' | 'B2B';
  advantages?: string[];
  product_benefits?: string[];
  company_benefits?: string[];
  differentiation?: string;
  products_services?: string;
  value_proposition?: string;
  competition?: string;
  [key: string]: any;
}

/**
 * בונה את הקונטקסט של החברה מפרטי החברה
 */
export const buildCompanyContext = (company: Company): string => {
  return `
מידע אודות החברה:

שם: ${company.name || 'לא צוין'}
סגמנט/תחום: ${company.segment || 'לא צוין'}
פרטים על המוצר/השירות: ${company.product_details || 'לא צוין'}
עלות המוצר/שירות: ${company.product_cost || 'לא צוין'}
סוגי מוצרים: ${company.product_types || 'לא צוין'}
קהל יעד: ${company.target_audience_type === 'C2B' ? 'קהל פרטי C2B' : company.target_audience_type === 'B2B' ? 'קהל עסקי B2B' : 'לא צוין'}
בידולים ויתרונות משמעותיים: ${Array.isArray(company.advantages) ? company.advantages.join(', ') : company.advantages || company.differentiation || 'לא צוין'}
תועלות המוצר/השירות: ${Array.isArray(company.product_benefits) ? company.product_benefits.join(', ') : company.product_benefits || 'לא צוין'}
תועלות החברה: ${Array.isArray(company.company_benefits) ? company.company_benefits.join(', ') : company.company_benefits || 'לא צוין'}
`;
};

/**
 * פרומפט לניתוח שיחת מכירה
 */
export const salesCallPrompt = (company: Company, transcript: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `אתה מאמן מכירות עם ניסיון רב וידע מקצועי של יותר מעשור שתפקידו לנתח שיחת מכירה טלפונית מלאה של נציג מכירות עם לקוח פוטנציאלי, לצורך בדיקת איכות תהליך המכירה, ביצועי הנציג וההשפעה על הלקוח. הניתוח נועד לבחון את כלל הכישורים והמרכיבים המקצועיים בהתייחס לתשובות של הלקוח.

${companyContext}

תמלול השיחה:
${transcript}

יש לבצע ניתוח לפרמטרים הדרושים לשיחת מכירה טלפונית אפקטיבית – מרגע הפתיחה ועד לסגירת המכירה או סיום השיחה.
להלן הפרמטרים לניתוח:

1. פתיח אנרגטי – האם השיחה נפתחה באנרגיה גבוהה מצד הנציג ויצרה רושם ראשוני חיובי? האם נוצרה של כימיה ראשונית בין הצדדים?
2. האם הנציג הציג את עצמו ואת החברה והתועלת שלה במשפט אחד בתחילת השיחה? האם הנציג הצליח לייצר סקרנות ולהבהיר את מטרת השיחה?
3. האם הנציג שאל את הלקוח מה הסיבה לפנייתו?
4. איתור כאב/צורך/בעיה – האם הנציג זיהה צורך, כאב או בעיה אצל הלקוח?
5. סגנונות תקשורת – האם הנציג זיהה את סגנון התקשרות בצד השני והתאים את עצמו מבחינת שיח וטון דיבור?
6. האם הנציג הקשיב באופן פעיל ואמיתי במהלך השיחה לדברי הלקוח ונתן לו את המקום לדבר?
7. האם הנציג דיבר רוב הזמן של השיחה (יותר מ 50% מהזמן)?
8. שאילת שאלות – האם הנציג השתמש בשאלות מבררת צורך, פתוחות, חכמות ומקדמות את ההבנה?
9. הצגת פתרון – האם הנציג הציג פתרון מותאם אישי לצרכים שהועלו בשיחה?
10. הצגת תועלות, ערכים ותוצאות – האם הנציג הדגיש את הערכים מוספים והתועלות המוחשיות והרגשיות עבור הצד השני?
11. האם הנציג הציג והרשים בידי ומומחיות מקצועית?
12. טיפול בהתלבטויות/התנגדויות – האם הנציג ידע לזהות האם ההתלבות היא אמיתית או מזויפת?
13. טיפול בהתלבטות עם "אני צריך לחשוב על זה" – איך הנציג טיפל בדחייה הזו? האם שמר על עניין? האם טיפל בהתבלטות באמצעות טכניקה מסוימת?
14. טיפול בהתבלטות "יקר לי" – האם הנציג טיפח בהתבלטות הזו בצורה טובה?
15. הצגת פתרון מותאם – האם הפתרון שהנציג נתן תאם לצורך שהועלה?
16. האם הנציג הציג במהלך השיחה את הערך של המוצר/שירות שהוא מספק מעל המחיר?
17. שימוש בעדויות/סימוכין/הוכחות חברתיות – האם הנציג עשה שימוש באלמנטים שמחזקים אמון?
18. הנעה לפעולה וסגירת המכירה – האם הייתה קריאה ברורה לפעולה? האם הנציג הוביל לסגירה?
19. טיפול בסירוב או דחייה בצורה מכבדת – האם השיחה הסתיימה בטון חיובי גם אם לא בוצעה רכישה?
20. סיכום שיחה ברור – האם סוכמו הדברים שנאמרו? האם הובהר מה השלב הבא?
21. זרימה וסדר (FLOW) – האם לשיחה הייתה זרימה טבעית, עקבית ומובנית? האם היה רצף ומבנה הגיוני לשיחה?
22. זיהוי איתותי קנייה – האם הנציג הבחין ברמזים חיוביים מצד הלקוח?
23. הצפת יתר / Over Sale – האם הייתה העמסת מידע שפגעה בבהירות ובתהליך המכירה?
24. בניית אמון - האם הנציג שידר אמינות, ביטחון ומקצועיות?
25. אינטונציה ודינמיקה קולית – האם נעשה שימוש נכון בטון, הדגשות וקצב?
26. התלהבות, אנרגיה ומוטיבציה – האם השיחה שידרה תשוקה אמיתית למוצר/שירות?
27. שפה מניעה, חיובית ונחרצת – האם נעשה שימוש בשיח חיובי ובמילים שמקדמות החלטה או שהשפה השלילית שלטה בשיחה?
28. האם הנציג עשה שימוש בשם הפרטי של הצד השני?

אני מצפה לקבל בסוף הניתוח:
1. ניתוח טקסטואלי מפורט של כל פרמטר (לפחות 2–3 משפטים)
2. ציון מספרי בין 1 ל-7 לכל פרמטר (1 הוא הציון הנמוך ביותר, ו-7 הוא הציון הגבוה ביותר)
3. סיכום והמלצות הכולל: חוזקות, נקודות לשיפור, ציון כולל, והמלצות לשיפור מקצועי בפעולות, בהתנהלות ובטכניקות המכירה

הדו"ח צריך להיות כתוב בעברית תקנית, בגובה העיניים אך בצורה מקצועית, ממוקדת ובעלת ערך למטרות חניכה ושיפור ביצועים.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "פתיח אנרגטי", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "הצגת עצמי והחברה", "text": "ניתוח מפורט", "score": 4},
    // וכן הלאה עבור כל 28 הפרמטרים
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פרומפט לניתוח שיחת פולו אפ מכירה
 */
export const salesFollowUpPrompt = (company: Company, transcript: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `אתה מאמן מכירות עם ניסיון רב וידע מקצועי של יותר מעשור שתפקידו לנתח שיחת פולו-אפ טלפונית במכירה. שיחה שמתבצעת כהמשך לשיחת מכירה קודמת עם לקוח פוטנציאלי. מטרתך היא לבחון את מקצועיות וכישורי הנציג, יכולת ההמשכיות של תהליך המכירה, והיכולת לסגור עסקה או להתקדם לשלב הבא בתהליך.

${companyContext}

תמלול השיחה:
${transcript}

להלן הפרמטרים לניתוח:
1. פתיח מקצועי - האם הנציג פתח את השיחה בצורה טובה, תוך התייחסות ברורה לשיחה הקודמת וסיבת ההתקשרות הנוכחית?
2. הימנעות משאלות כן/לא בתחילת השיחה - האם הנציג נמנע משאלות סגורות כגון "האם חשבת על ההצעה?" או "מה החלטת?" בתחילת השיחה?
3. זיהוי מצב עדכני של הלקוח - האם הנציג בירר מה השתנה או התקדם מאז השיחה הקודמת?
4. חידוד צרכים - האם הנציג חיזק מחדש את הצורך והכאב של הלקוח שזוהו בשיחה הקודמת?
5. הזכרת התועלות - האם הנציג הזכיר בצורה ממוקדת את התועלות המרכזיות של המוצר/שירות שכבר הוצגו בשיחה הקודמת?
6. הצגת מידע חדש - האם הנציג הציג מידע חדש, ערך מוסף או יתרונות שלא הוזכרו בשיחה הקודמת?
7. טיפול בהתנגדויות חדשות - האם הנציג זיהה וטיפל ביעילות בהתנגדויות או ספקות חדשים שעלו בשיחה הנוכחית?
8. חיזוק אמון - האם הנציג חיזק את האמון ביחסים עם הלקוח דרך עדויות, דוגמאות או סיפורי הצלחה?
9. בדיקת קבלת החלטות - האם הנציג בירר מי מקבל ההחלטות הסופי ומה השלבים הבאים בתהליך ההחלטה מצד הלקוח?
10. יצירת דחיפות - האם הנציג יצר תחושת דחיפות ברורה להחלטה, מבלי ליצור לחץ מוגזם? 
11. הנעה לפעולה - האם הנציג הניע את הלקוח לקראת פעולה ברורה ומוגדרת בסוף השיחה?
12. סיכום והמשכיות - האם הנציג סיכם בבהירות את השיחה והגדיר במדויק את השלב הבא בתהליך המכירה?
13. התאמה אישית והקשבה - האם הנציג הפגין הקשבה פעילה והתאים את המסרים בהתאם לצרכי הלקוח הספציפיים?
14. מקצועיות וידע - האם הנציג הפגין ידע מעמיק ומקצועיות לגבי המוצר/שירות ופתרונות אפשריים?
15. שפה חיובית ועוצמתית - האם הנציג השתמש בשפה חיובית, אסרטיבית ומכוונת החלטה?

אני מצפה לקבל בסוף הניתוח:
1. ניתוח טקסטואלי מפורט של כל פרמטר (לפחות 2–3 משפטים)
2. ציון מספרי בין 1 ל-7 לכל פרמטר (1 הוא הציון הנמוך ביותר, ו-7 הוא הציון הגבוה ביותר)
3. סיכום והמלצות הכולל: חוזקות, נקודות לשיפור, ציון כולל, והמלצות לשיפור מקצועי בפעולות, בהתנהלות ובטכניקות המכירה

הדו"ח צריך להיות כתוב בעברית תקנית, בגובה העיניים אך בצורה מקצועית, ממוקדת ובעלת ערך למטרות חניכה, שיפור ביצועים או הערכה.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "פתיח מקצועי", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "הימנעות משאלות כן/לא בתחילת השיחה", "text": "ניתוח מפורט", "score": 4},
    // וכן הלאה עבור כל 15 הפרמטרים
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פרומפט לניתוח שיחת שירות
 */
export const serviceCallPrompt = (company: Company, transcript: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `אתה מאמן שירות עם ניסיון רב וידע מקצועי של יותר מעשור הפועל כיועץ שירות בכיר. תפקידך לנתח שיחה מוקלטת או מתמוללת בין נציג שירות ללקוח, ולהפיק דוח מקצועי, ביקורתי ומעמיק המיועד להנהלה. עליך לסקור את השיחה לפי כל שלבי השירות, לשאול שאלות ביקורת ממוקדות, לענות עליהן לפי הטקסט שהתקבל, לתת ציון מספרי לכל פרמטר בסרגל של 1–7 (1- הציון הנמוך ביותר, 7 הציון הגבוה ביותר), ולסכם את הממצאים בנקודות חוזק וחולשה.

${companyContext}

תמלול השיחה:
${transcript}

הניתוח חייב לכלול את הפרמטרים הבאים:
1. פתיחה והצגת שם הנציג - האם הנציג מציג את עצמו ואת החברה?
2. בירור הצורך של הלקוח - האם הנציג שואל שאלות בירור מדויקות כדי להבין לעומק את מהות הבעיה והפניה של הלקוח?
3. גישה ללקוח: האם הנציג מייצר ומביע אמפתיה והבנה (לא הזדהות!) במהלך השיחה – משתמש משפטים כגון "אני מבין אותך", "זה עשוי להיות מתסכל, אני כאן לעזור"
4. האם הנציג הציג טונציה רגועה לאורך כל השיחה?
5. האם הנציג עושה שימוש בשם הפרטי של הלקוח במהלך השיחה?
6. האם הנציג מקשיב באופן פעיל ללקוח ונותן לו לדבר?
7. האם הנציג מציג הסבר ברור, בהיר ונגיש ללקוח
8. האם הנציג חוזר על הבעיה כדי לוודא שהבין?
9. האם התקשורת של הנציג היא שירותית (טון, שפה, סבלנות)
10. שפה חיובית ולא שלילית - האם הנציג משתמש בשפה חיובית ומקדמת מסר, הימנעות משפה שלילית. שימוש בשפה ברורה, אדיבה ומקצועית, ללא סלנג
11. האם הלקוח קיבל פתרון לפניה שלו והוא שבע רצון?
12. האם הנציג מביע יעילות ובקיאות מקצועית?
13. האם הנציג מעביר את הפנייה אם צריך למחלקה טכנית?
14. האם הנציג העניק פתרון איכותי, ממוקד ומקצועי?
15. האם הנציג ביצע סיכום שיחה בסיומה?
16. האם הנציג העניק ערך מוסף ללקוח? כגון טיפ, פתרון עתידי, או פעולה פרואקטיבית?
17. סיכום השיחה - האם הנציג סיכם את מה שנאמר או סיכם את הפעולה שתבוצע?
18. האם היו במהלך השיחה זמני החזקת שיחות (מעבר לדקה אחת) בהן הלקוח המתין על הקו?

אני מצפה לקבל בסוף הניתוח:
1. ניתוח טקסטואלי מפורט של כל פרמטר (לפחות 2–3 משפטים)
2. ציון מספרי בין 1 ל-7 לכל פרמטר (1 הוא הציון הנמוך ביותר, ו-7 הוא הציון הגבוה ביותר)
3. סיכום והמלצות הכולל: חוזקות, נקודות לשיפור, ציון כולל, והמלצות לשיפור מקצועי בפעולות, בהתנהלות ובטכניקות שירות

הדו"ח צריך להיות כתוב בעברית תקנית, בגובה העיניים אך בצורה מקצועית, ממוקדת ובעלת ערך למטרות חניכה, שיפור ביצועים או הערכה.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "פתיחה והצגת שם הנציג", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "בירור הצורך של הלקוח", "text": "ניתוח מפורט", "score": 4},
    // וכן הלאה עבור כל 18 הפרמטרים
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פרומפט לניתוח שיחת תיאום פגישה
 */
export const appointmentSettingPrompt = (company: Company, transcript: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `אתה מאמן מכירות עם ניסיון רב וידע מקצועי של יותר מעשור שתפקידו לנתח שיחת לקוח סמוי שמטרתה לתאם פגישה, כחלק מבדיקת תהליך מכירה. עליך להעריך את איכות השיחה, מבנה השיחה, יכולות הנציג, ורמת ההשפעה של השיחה – בהתאם לסט מקצועי של פרמטרים מעולם המכירות הטלפוני בדגש על תאום פגישה ולא על מכירה טלפונית.

${companyContext}

תמלול השיחה:
${transcript}

להלן הפרמטרים לניתוח:
1. פתיח אנרגטי – האם השיחה נפתחה באנרגיה גבוהה מצד הנציג ויצרה רושם ראשוני חיובי? האם נוצרה של כימיה ראשונית בין הצדדים?
2. האם הנציג הציג את עצמו ואת החברה והתועלת שלה במשפט אחד בתחילת השיחה? האם הנציג הצליח לייצר סקרנות ולהבהיר את מטרת השיחה?
3. האם הנציג שאל את הלקוח מה הסיבה לפנייתו?
4. איתור כאב/צורך/בעיה – האם הנציג זיהה צורך, כאב או בעיה אצל הלקוח?
5. סגנונות תקשורת – האם הנציג זיהה את סגנון התקשרות בצד השני והתאים את עצמו מבחינת שיח וטון דיבור?
6. האם הנציג הקשיב באופן פעיל ואמיתי במהלך השיחה לדברי הלקוח ונתן לו את המקום לדבר?
7. האם הנציג דיבר רוב הזמן של השיחה (יותר מ 50% מהזמן)?
8. שאילת שאלות – האם הנציג השתמש בשאלות מבררת צורך, פתוחות, חכמות ומקדמות את ההבנה?
9. הצגת פתרון – האם הנציג הציג פתרון מותאם אישי לצרכים שהועלו בשיחה תוך חתירה לתאום פגישה?
10. הצגת תועלות, ערכים ותוצאות – האם הנציג הדגיש את הערכים מוספים והתועלות המוחשיות והרגשיות עבור הצד השני?
11. האם הנציג הציג והרשים בידע ומומחיות מקצועית?
12. טיפול בהתלבטות עם "אני צריך לחשוב על זה" – איך הנציג טיפל בדחייה הזו? האם שמר על עניין? האם טיפל בהתבלטות באמצעות טכניקה מסוימת?
13. שימוש בעדויות/סימוכין/הוכחות חברתיות – האם הנציג עשה שימוש באלמנטים שמחזקים אמון?
14. הנעה לפעולה וסגירת המכירה – האם הייתה קריאה ברורה לתאום פגישה?
15. טיפול בסירוב או דחייה בצורה מכבדת – האם השיחה הסתיימה בטון חיובי גם אם לא בוצעה רכישה?
16. זרימה וסדר (FLOW) – האם לשיחה הייתה זרימה טבעית, עקבית ומובנית? האם היה רצף ומבנה הגיוני לשיחה?
17. הצפת יתר / Over Sale – האם הייתה העמסת מידע שפגעה בבהירות ובתהליך תאום הפגישה?
18. בניית אמון - האם הנציג שידר אמינות, ביטחון ומקצועיות?
19. אינטונציה ודינמיקה קולית – האם נעשה שימוש נכון בטון, הדגשות וקצב?
20. התלהבות, אנרגיה ומוטיבציה – האם השיחה שידרה תשוקה אמיתית למוצר/שירות?
21. שפה מניעה, חיובית ונחרצת – האם נעשה שימוש בשיח חיובי ובמילים שמקדמות החלטה או שהשפה השלילית שלטה בשיחה?
22. האם הנציג עשה שימוש בשם הפרטי של הצד השני?

אני מצפה לקבל בסוף הניתוח:
1. ניתוח טקסטואלי מפורט של כל פרמטר (לפחות 2–3 משפטים)
2. ציון מספרי בין 1 ל-7 לכל פרמטר (1 הוא הציון הנמוך ביותר, ו-7 הוא הציון הגבוה ביותר)
3. סיכום והמלצות הכולל: חוזקות, נקודות לשיפור, ציון כולל, והמלצות לשיפור מקצועי בפעולות, בהתנהלות ובטכניקות המכירה

הדו"ח צריך להיות כתוב בעברית תקנית, בגובה העיניים אך בצורה מקצועית, ממוקדת ובעלת ערך למטרות חניכה, שיפור ביצועים או הערכה.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "פתיח אנרגטי", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "הצגת עצמי והחברה", "text": "ניתוח מפורט", "score": 4},
    // וכן הלאה עבור כל 22 הפרמטרים
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פרומפט לניתוח שיחת פולו אפ תיאום פגישה
 */
export const appointmentFollowUpPrompt = (company: Company, transcript: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `אתה מאמן מכירות עם ניסיון רב וידע מקצועי של יותר מעשור שתפקידו לנתח שיחת פולו-אפ טלפונית שמטרתה לתאם פגישה עם לקוח פוטנציאלי. השיחה מתבצעת כהמשך לפנייה קודמת (ליד/שיחה/השארת פרטים), ומטרתך היא לבחון את מקצועיות וכישורי הנציג, היכולת להתניע תהליך מכירה אפקטיבי, ולבסס שלב המשך ברור עם הלקוח.

${companyContext}

תמלול השיחה:
${transcript}

הפרמטרים שעליך לנתח:
1. פתיח מקצועי ומדויק – האם הנציג התחיל את השיחה באנרגיה טובה, תוך תזכורת לפנייה/שיחה הקודמת?
2. האם הנציג עשה את הטעות השכיחה ושאל את הצד השני בתחילת השיחה שאלת כן/לא כגון: "האם חשבת על זה", "מה החלטת", "האם אתה רוצה לקנות"?
3. חיבור רלוונטי להיסטוריית הקשר – האם הייתה התייחסות של הנציג בתחילת השיחה לשיחה הקודמת, שאלות שעלו, או תכנים שנשלחו? האם הודגש המשך רציף?
4. איתור עדכונים מהלקוח / בירור מצב נוכחי – האם הנציג בירר אם חלו שינויים בצרכים או בהחלטות מהשיחה או אינטראקציה קודמת?
5. שיקוף הצורך וזיהוי מחודש של כאב – האם הנציג התייחס לצורך הקיים או חידד אותו מחדש?
6. שאלות מקדמות לקראת תיאום – האם נעשה שימוש בשאלות שמובילות את הלקוח להסכמה לפגישה?
7. הצגת ערך הפגישה / מה יצא ללקוח ממנה – האם הנציג הבהיר מה התועלות לפגישה ומה הרווח הצפוי?
8. איך הנציג התמודד התנגדויות שעולות מהצד השני ("אין לי זמן", "נדבר בהמשך", "תשלח לי קודם")
9. האם הנציג ידע לנהל את הדחייה ולהחזיר את השיחה למסלול?
10. שימוש בשפה חיובית, ממוקדת ונחרצת – האם השיחה כללה שפה מעודדת, ברורה ולא מתנצלת?
11. הנעה ברורה לתיאום פגישה – האם הנציג הניע לסגירת תאריך/שעה בצורה אסרטיבית אך שירותית?
12. סיכום וסגירה מקצועית – האם סוכמה הפגישה (כולל אמצעי תזכורת, שליחת חומרים וכו')?

אני מצפה לקבל בסוף הניתוח:
1. ניתוח טקסטואלי מפורט של כל פרמטר (לפחות 2–3 משפטים)
2. ציון מספרי בין 1 ל-7 לכל פרמטר (1 הוא הציון הנמוך ביותר, ו-7 הוא הציון הגבוה ביותר)
3. סיכום והמלצות הכולל: חוזקות, נקודות לשיפור, ציון כולל, והמלצות לשיפור מקצועי בפעולות, בהתנהלות ובטכניקות המכירה

הדו"ח צריך להיות כתוב בעברית תקנית, בגובה העיניים אך בצורה מקצועית, ממוקדת ובעלת ערך למטרות חניכה, שיפור ביצועים או הערכה.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "פתיח מקצועי ומדויק", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "הימנעות משאלות כן/לא בתחילת השיחה", "text": "ניתוח מפורט", "score": 4},
    // וכן הלאה עבור כל 12 הפרמטרים
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פרומפט כללי לכל סוגי הניתוחים
 */
export const generalAnalysisPrompt = (company: Company, transcript: string, analysisType: string): string => {
  const companyContext = buildCompanyContext(company);
  
  return `ההנחיות שלהלן רלוונטיות לכלל סוגי הניתוחים. אבקש בקרת שיחה לפי הסדר שלהלן ועפ"י התנאים שלהלן:

1. תעבור על כל פרטי החברה כדלהלן:
${companyContext}

2. תמלול השיחה:
${transcript}

3. סוג הניתוח המבוקש: ${analysisType}

4. מה אני מצפה לקבל ממך בסוף הניתוח:
· קריאת תמלול השיחה והבנה: תקרא את תמלול השיחה במלואה ונסה להבין את המטרות והכוונות של כל חלק בשיחה.
· ניתוח וחשיפת ליקויים: זיהוי אלמנטים בשיחה שניתן לשפר, כולל תזמון שגוי, אמירות לא נכונות או חסרות, ואי כיבוד קווי המנחה של אופי השיחה.
· בקר את השיחה באופן קשוח תוך מתן הצעות לשיפור והשגת תוצאות אופטימליות.
· הצעות לשיפור: הצע דרכי שיפור לכל ליקוי שנמצא. נסה להיות חד וממוקד.
· משוב ולסכם: הצג את התובנות הכלליות מהשיחה וסכם את ההמלצות בצורה ברורה, בהירה וממוקדת.
· בנה דוח מסכם עבור השיחה הכולל את הניתוח המפורט של ליקויים שנמצאו והצעות לשיפור. הפרד בין תיאור הליקוי לבין ההצעה לשיפור כדי לייצר מבנה ברור ומובנה.

5. יש לנתח את השיחה בהתאמה מדויקת לסוג הניתוח המבוקש.

ענה בפורמט JSON בלבד עם המבנה הבא:
{
  "analysis": [
    {"parameter": "שם הפרמטר", "text": "ניתוח מפורט", "score": 5},
    {"parameter": "שם הפרמטר", "text": "ניתוח מפורט", "score": 4},
    // ...
  ],
  "summary": {
    "strengths": ["חוזקה 1", "חוזקה 2", "חוזקה 3"],
    "improvements": ["נקודה לשיפור 1", "נקודה לשיפור 2", "נקודה לשיפור 3"],
    "totalScore": 75,
    "recommendations": ["המלצה 1", "המלצה 2", "המלצה 3"]
  }
}`;
};

/**
 * פונקציה ראשית לקבלת פרומפט המתאים לסוג הניתוח
 */
export function getPromptByAnalysisType(
  company: Company,
  transcript: string,
  analysisType: string
): string {
  switch (analysisType) {
    case 'sales':
      return salesCallPrompt(company, transcript);
    case 'sales_followup':
      return salesFollowUpPrompt(company, transcript);
    case 'appointment_setting':
      return appointmentSettingPrompt(company, transcript);
    case 'appointment_followup':
      return appointmentFollowUpPrompt(company, transcript);
    case 'service':
      return serviceCallPrompt(company, transcript);
    case 'general':
      return generalAnalysisPrompt(company, transcript, 'כללי');
    default:
      return generalAnalysisPrompt(company, transcript, analysisType); // ברירת מחדל לניתוח כללי
  }
} 